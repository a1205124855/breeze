yum install git content -y
yum install gcc gettext autoconf libtool automake make pcre-devel asciidoc xmlto c-ares-devel libev-devel libsodium-devel mbedtls-devel zlib-devel openssl-devel -y

#下载编译ss
mkdir /root/ss
   
cd /root/ss
git clone https://github.com/shadowsocks/shadowsocks-libev.git
cd shadowsocks-libev
git submodule update --init --recursive
./autogen.sh && ./configure && make

#下载编译obfs
cd /root/ss
git clone https://github.com/shadowsocks/simple-obfs.git
cd simple-obfs
git submodule update --init --recursive
./autogen.sh && ./configure && make
   
#Server.config
cat > /root/ss/config.json <<-EOF
{
   "server":"0.0.0.0",
   "server_port":443,
   "password":"PASSWORD",
   "method":"chacha20-ietf-poly1305",
   "plugin":"/root/ss/simple-obfs/src/obfs-server",
   "plugin_opts": "obfs=tls;fast-open;obfs-host=download.ubuntu.com",
   "reuse_port": true,
   "fast_open": true,
   "timeout":600,
   "udp_timeout":600,
   "dscp":"EF",
   "mode":"tcp_and_udp",
   "ipv6_first":true,
   "no_delay":true
} 
EOF

#Server.sh
export PATH=$PATH:/root/ss/shadowsocks-libev/src
kill $(ps -ef | grep ss-server | grep -v grep | awk '{print $2}')
nohup ss-server -c /root/ss/config.json > /dev/null 2>&1 &

#Client.firewalld
firewall-cmd --zone=public --add-port=443/tcp
firewall-cmd --permanent --zone=public --add-port=443/tcp

#Client.config
cat > /root/ss/config.json <<-EOF
{
   "server":"IP",
   "server_port":17680,
   "local_address": "127.0.0.1",
   "local_port":1080,
   "password":"PASSWORD",
   "method":"chacha20-ietf-poly1305",
   "plugin":"/root/ss/simple-obfs/src/obfs-local",
   "plugin_opts": "obfs=tls;obfs-host=download.ubuntu.com",
   "reuse_port": true,
   "fast_open": true
}
EOF

#Client.sh
export PATH=$PATH:/root/ss/shadowsocks-libev/src
kill $(ps -ef | grep ss-local | grep -v grep | awk '{print $2}')
nohup ss-local -c /root/ss/config.json > /dev/null 2>&1 &

#Client.firewalld
firewall-cmd --zone=public --add-port=1080/tcp
firewall-cmd --permanent --zone=public --add-port=1080/tcp
